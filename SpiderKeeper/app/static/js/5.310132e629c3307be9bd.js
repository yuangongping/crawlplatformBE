webpackJsonp([5],{URop:function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,"\n.el-row {\n  padding-top: 20px;\n}\n.el-row:nth-child(1) {\n    padding-top: 0;\n}\n.el-row .el-button {\n    float: right;\n}\n.spider {\n  margin-top: 20px;\n}\n.dispalyLog {\n  word-wrap: break-word;\n  word-break: break-all;\n  overflow: hidden;\n}\n#el-icon-info {\n  margin-left: 5px;\n}\n.tip {\n  font-size: 16px;\n  padding-left: 10px;\n  border-left: 2px solid steelblue;\n  margin: 10px 0px 0px 0px;\n}\n.sub {\n  margin: 10px 0px 25px 20px;\n}\n.el-checkbox {\n  margin-left: 10px;\n}\n.el-checkbox:first-child {\n  margin-left: 30px;\n}\n",""])},q3oi:function(e,t,o){var r=o("URop");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);o("rjj0")("d94606d0",r,!0)},"v/oH":function(e,t,o){"use strict";t.d=function(e,t){return Object(i.a)({url:"/allspider",method:"get",params:{pageIndex:e,pageSize:t}})},t.a=function(e){return e.selectedmonths=0==e.selectedmonths.length?null:e.selectedmonths.join(","),e.selecteddays=0==e.selecteddays.join(",").length?null:e.selecteddays.join(","),e.selectedhours=0==e.selectedhours.join(",").length?null:e.selectedhours.join(","),e.selectedminutes=0==e.selectedminutes.join(",").length?null:e.selectedminutes.join(","),Object(i.a)({url:"/addscheduler",method:"post",data:l.stringify(e)})},t.c=function(e){return Object(i.a)({url:"/delscheduler",method:"get",params:{job_instance_id:e}})},t.g=function(e,t){return Object(i.a)({url:"/runonce",method:"post",data:l.stringify({project_id:e,spider_name:t,spider_arguments:"",daemon:"auto",priority:0})})},t.b=function(e,t,o){return new n.a(function(r,n){Object(i.a)({url:"/cancelspider",method:"post",data:l.stringify({project_id:e,project_name:t,job_instance_id:o})}).then(function(e){r(e)}).catch(function(e){n(e)})})},t.e=function(e,t){return Object(i.a)({url:"/masterlog",method:"get",params:{project_id:e,job_exec_id:t}})},t.f=function(e,t){return Object(i.a)({url:"/slavelog",method:"get",params:{project_id:e,job_exec_id:t}})};var r=o("//Fk"),n=o.n(r),i=o("vLgD"),l=o("1nuA")},xAsR:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("mvHQ"),n=o.n(r),i=o("Xxa5"),l=o.n(i),s=o("exGp"),a=o.n(s),c=o("ICYs"),d=o("EMlb"),u=o("v/oH"),p={data:function(){return{selectedmonths:[],selecteddays:[],selectedhours:[],selectedminutes:[],selectedseconds:[],developer_list:[],project_type:["开放平台","公文公告","餐饮","舆情","其他"],formRules:{project_name:[{required:!0,message:"请输入项目英文名！",trigger:"blur"},{pattern:/^[A-Za-z0-9_]+$/,message:"不允许输入空格等特殊符号"}],project_alias:[{required:!0,message:"请输入项目中文名！",trigger:"blur"}],for_project:[{required:!0,message:"请输入服务项目字段信息！",trigger:"blur"}],applicant:[{required:!0,message:"请输入项目申请者字段信息！",trigger:"blur"}],developers:[{required:!0,message:"请输入项目开发者字段信息！",trigger:"blur"}],project_cate:[{required:!0,message:"请输入主题分类字段信息！",trigger:"blur"}]},projectTpye:{0:"单机",1:"分布式"},editProjectIinfoForm:{},project_info:{is_msd:null,project_id:null,project_name:null,project_alias:null,create_time:null,developers:"",for_project:null,applicant:null,spiders:[]},schedulerForm:{project_id:null,spider_name:null,selectedmonths:[1,2,3,4,5,6,7,8,9,10,11,12],selecteddays:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],selectedhours:[0],selectedminutes:[0],priority:0},log:[],editProjectInfodialog:!1,dialogFormVisible:!1,dialogLogVisible:!1,formLabelWidth:"200",loading:!1}},mounted:function(){this.getProjectInfo(),this.listDevelopers()},methods:{del_scheduler:function(e){var t=this;return a()(l.a.mark(function o(){return l.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(u.c)(e);case 2:if(200!==o.sent.code){o.next=7;break}t.getProjectInfo(),o.next=9;break;case 7:return t.$message.error("信息更新出错"),o.abrupt("return",!1);case 9:case"end":return o.stop()}},o,t)}))()},clickEditInfo:function(){this.editProjectIinfoForm=JSON.parse(n()(this.project_info)),this.editProjectIinfoForm.developers=this.editProjectIinfoForm.developers.split(","),this.editProjectInfodialog=!0},listDevelopers:function(){var e=this;return a()(l.a.mark(function t(){var o,r,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c.d)();case 3:for(o=t.sent,r=[],n=0;n<o.data.length;n++)"0"===o.data[n].developer_status&&r.push(o.data[n].developer_name);e.developer_list=r,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.$message.error("开发人员列表获取错误 "+t.t0);case 12:case"end":return t.stop()}},t,e,[[0,9]])}))()},renderHeader:function(e){return e("a",{attrs:{href:"https://blog.csdn.net/weixin_38296752/article/details/79715337",target:"_blank"}},["cron表达式",e("i",{attrs:{id:"el-icon-info"},class:"el-icon-info"},[])])},getProjectInfo:function(){var e=this;return a()(l.a.mark(function t(){var o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(d.c)(e.$route.params.name);case 3:o=t.sent,e.project_info=o.data,e.schedulerForm.project_id=o.data.project_id,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.$message.error("获取信息错误 "+t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},showSchedulerForm:function(e){this.schedulerForm.spider_name=e,this.dialogFormVisible=!0},addScheduler:function(){var e=this;this.dialogFormVisible=!1,this.loading=!0,Object(u.a)(this.schedulerForm).then(function(t){e.loading=!1,e.$message("添加调度成功"),e.getProjectInfo(e.$route.params.name).then(function(t){e.project_info=t.data,e.schedulerForm.project_id=t.data.project_id}).catch(function(t){e.loading=!1,console.log(t)})})},submitEditProjectInfoForm:function(){var e=this;return a()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.editProjectIinfoForm.developers=e.editProjectIinfoForm.developers.join(","),t.next=3,Object(d.a)(e.editProjectIinfoForm);case 3:if(200!==t.sent.code){t.next=10;break}e.editProjectInfodialog=!1,e.$message.success("信息更新成功！"),e.getProjectInfo(),t.next=12;break;case 10:return e.$message.error("信息更新出错"),t.abrupt("return",!1);case 12:case"end":return t.stop()}},t,e)}))()},runOnce:function(e,t){var o=this;this.loading=!0,Object(u.g)(e,t).then(function(e){"success"===e.status?(o.loading=!1,o.getProjectInfo()):(o.listLoading=!1,alert("Error"))})},cancelspider:function(e,t,o){var r=this;return a()(l.a.mark(function n(){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r.loading=!0,n.next=4,Object(u.b)(e,t,o);case 4:r.loading=!1,r.getProjectInfo(),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),r.$message.error("取消爬虫错误 "+n.t0);case 11:case"end":return n.stop()}},n,r,[[0,8]])}))()},viewMasterLog:function(e,t){var o=this;this.dialogLogVisible=!0,this.log=[],Object(u.e)(e,t).then(function(e){o.log=e.log})},viewSlaveLog:function(e,t){var o=this;this.dialogLogVisible=!0,this.log=[],Object(u.f)(e,t).then(function(e){o.log=e.log})},delProject:function(){var e=this;this.$confirm("此操作将永久删除该项目, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(d.d)(e.project_info.project_name).then(function(t){"success"===t.status&&(e.$message("删除项目成功"),e.$router.push({path:"/project/all"}))})})}}},_={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container",attrs:{"element-loading-text":"添加调度中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8"}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[e._v(e._s(e.project_info.project_name)+" - "+e._s(e.project_info.project_alias))]),e._v(" "),o("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.clickEditInfo}},[e._v("编辑项目信息")])],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("strong",[e._v("更新时间: ")]),e._v(e._s(e.project_info.create_time))]),e._v(" "),o("el-col",{attrs:{span:12}},[o("strong",[e._v("开发人员: ")]),e._l(e.project_info.developers.split(","),function(t,r){return o("el-tag",{key:r,staticStyle:{"margin-left":"5px"},attrs:{type:"success"}},[e._v(e._s(t))])})],2)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("strong",[e._v("需求项目: ")]),e._v(e._s(e.project_info.for_project))]),e._v(" "),o("el-col",{attrs:{span:12}},[o("strong",[e._v("申请开发人: ")]),e._v(e._s(e.project_info.applicant))])],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("strong",[e._v("主题分类: ")]),e._v(e._s(e.project_info.project_cate))]),e._v(" "),o("el-col",{attrs:{span:12}},[o("strong",[e._v("蜘蛛类型: ")]),e._v(e._s(e.projectTpye[e.project_info.is_msd]))])],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:8,offset:16}},[o("el-button",{attrs:{type:"danger"},on:{click:e.delProject}},[o("i",{staticClass:"el-icon-delete el-icon--left"}),e._v("删除项目")])],1)],1)],1),e._v(" "),o("el-card",{staticClass:"box-card spider"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[e._v("爬虫运行情况")]),e._v(" "),o("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}})],1),e._v(" "),o("el-table",{attrs:{data:e.project_info.spiders,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[o("el-table-column",{attrs:{align:"center",label:"序号",width:"65",type:"index"}}),e._v(" "),o("el-table-column",{attrs:{label:"蜘蛛名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.spider_name)+"\n        ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"调度类型",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.circle_type)+"       ")]),e._v(" "),"periodic"!=t.row.circle_type?o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.showSchedulerForm(t.row.spider_name)}}},[e._v("添加调度")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"cron表达式","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return["periodic"===t.row.circle_type?o("span",[e._v(e._s(t.row.cron))]):o("span",[e._v("无")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"最近运行时间",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.last_run_time))])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"最近运行状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=t.row.circle_type?o("el-tag",[e._v(e._s(t.row.last_run_status))]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.runOnce(e.project_info.project_id,t.row.spider_name)}}},[e._v("运行")]),e._v(" "),"RUNNING"==t.row.last_run_status?o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.cancelspider(e.project_info.project_id,e.project_info.project_name,t.row.job_instance_id)}}},[e._v("取消")]):e._e(),e._v(" "),"0"==e.project_info.is_msd&&null!==t.row.job_exec_id?o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.viewMasterLog(e.project_info.project_id,t.row.job_exec_id)}}},[e._v("  log ")]):e._e(),e._v(" "),"1"==e.project_info.is_msd&&null!==t.row.job_exec_id?o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.viewMasterLog(e.project_info.project_id,t.row.job_exec_id)}}},[e._v("主log")]):e._e(),e._v(" "),"1"==e.project_info.is_msd&&null!==t.row.job_exec_id?o("el-button",{attrs:{size:"mini"},on:{click:function(o){e.viewSlaveLog(e.project_info.project_id,t.row.job_exec_id)}}},[e._v("从log")]):e._e(),e._v(" "),"periodic"==t.row.circle_type?o("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(o){e.del_scheduler(t.row.job_instance_id)}}},[e._v("删除")]):e._e()]}}])})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"编辑项目",visible:e.editProjectInfodialog},on:{"update:visible":function(t){e.editProjectInfodialog=t}}},[o("el-form",{attrs:{model:e.editProjectIinfoForm,rules:e.formRules}},[o("el-form-item",{attrs:{label:"项目英文名称","label-width":e.formLabelWidth,prop:"project_name"}},[o("el-input",{attrs:{"auto-complete":"off",disabled:!0},model:{value:e.editProjectIinfoForm.project_name,callback:function(t){e.$set(e.editProjectIinfoForm,"project_name",t)},expression:"editProjectIinfoForm.project_name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"项目中文名称","label-width":e.formLabelWidth,prop:"project_alias"}},[o("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editProjectIinfoForm.project_alias,callback:function(t){e.$set(e.editProjectIinfoForm,"project_alias",t)},expression:"editProjectIinfoForm.project_alias"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"服务项目","label-width":e.formLabelWidth,prop:"for_project"}},[o("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editProjectIinfoForm.for_project,callback:function(t){e.$set(e.editProjectIinfoForm,"for_project",t)},expression:"editProjectIinfoForm.for_project"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"项目申请者","label-width":e.formLabelWidth,prop:"applicant"}},[o("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editProjectIinfoForm.applicant,callback:function(t){e.$set(e.editProjectIinfoForm,"applicant",t)},expression:"editProjectIinfoForm.applicant"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"项目开发者","label-width":e.formLabelWidth,prop:"developers"}},[o("br"),e._v(" "),o("el-checkbox-group",{model:{value:e.editProjectIinfoForm.developers,callback:function(t){e.$set(e.editProjectIinfoForm,"developers",t)},expression:"editProjectIinfoForm.developers"}},e._l(this.developer_list,function(e){return o("el-checkbox",{key:e,attrs:{label:e,name:e}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"主题分类","label-width":e.formLabelWidth,prop:"project_cate"}},[o("br"),e._v(" "),o("el-radio-group",{model:{value:e.editProjectIinfoForm.project_cate,callback:function(t){e.$set(e.editProjectIinfoForm,"project_cate",t)},expression:"editProjectIinfoForm.project_cate"}},[o("el-radio",{attrs:{label:this.project_type[0]}},[e._v(e._s(this.project_type[0]))]),e._v(" "),o("el-radio",{attrs:{label:this.project_type[1]}},[e._v(e._s(this.project_type[1]))]),e._v(" "),o("el-radio",{attrs:{label:this.project_type[2]}},[e._v(e._s(this.project_type[2]))]),e._v(" "),o("el-radio",{attrs:{label:this.project_type[3]}},[e._v(e._s(this.project_type[3]))]),e._v(" "),o("el-radio",{attrs:{label:this.project_type[4]}},[e._v(e._s(this.project_type[4]))])],1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.editProjectInfodialog=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.submitEditProjectInfoForm}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{visible:e.dialogLogVisible},on:{"update:visible":function(t){e.dialogLogVisible=t}}},e._l(e.log,function(t){return o("p",{key:t,staticClass:"dispalyLog"},[e._v(e._s(t))])})),e._v(" "),o("el-dialog",{attrs:{title:"添加调度",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("div",{staticClass:"tip"},[e._v("优先级")]),e._v(" "),o("div",{staticClass:"sub"},[o("el-radio-group",{model:{value:e.schedulerForm.priority,callback:function(t){e.$set(e.schedulerForm,"priority",t)},expression:"schedulerForm.priority"}},[o("el-radio",{attrs:{label:-1}},[e._v("较低")]),e._v(" "),o("el-radio",{attrs:{label:0}},[e._v("常规")]),e._v(" "),o("el-radio",{attrs:{label:1}},[e._v("较高")]),e._v(" "),o("el-radio",{attrs:{label:2}},[e._v("最高")])],1)],1),e._v(" "),o("div",{staticClass:"tip"},[e._v("时间参数")]),e._v(" "),o("div",{staticClass:"sub"},[o("el-tabs",{attrs:{type:"border-card"}},[o("el-tab-pane",{attrs:{label:"月份选择"}},[o("el-checkbox-group",{model:{value:e.schedulerForm.selectedmonths,callback:function(t){e.$set(e.schedulerForm,"selectedmonths",t)},expression:"schedulerForm.selectedmonths"}},e._l(12,function(t){return o("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t>=10?t:"0"+String(t)))])}))],1),e._v(" "),o("el-tab-pane",{attrs:{label:"天选择"}},[o("el-checkbox-group",{model:{value:e.schedulerForm.selecteddays,callback:function(t){e.$set(e.schedulerForm,"selecteddays",t)},expression:"schedulerForm.selecteddays"}},e._l(31,function(t){return o("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t>=10?t:"0"+String(t)))])}))],1),e._v(" "),o("el-tab-pane",{attrs:{label:"小时选择"}},[o("el-checkbox-group",{model:{value:e.schedulerForm.selectedhours,callback:function(t){e.$set(e.schedulerForm,"selectedhours",t)},expression:"schedulerForm.selectedhours"}},e._l(24,function(t){return o("el-checkbox",{key:t-1,attrs:{label:t-1}},[e._v(e._s(t-1>=10?t-1:"0"+String(t-1)))])}))],1),e._v(" "),o("el-tab-pane",{attrs:{label:"分钟选择"}},[o("el-checkbox-group",{model:{value:e.schedulerForm.selectedminutes,callback:function(t){e.$set(e.schedulerForm,"selectedminutes",t)},expression:"schedulerForm.selectedminutes"}},e._l(60,function(t){return o("el-checkbox",{key:t-1,attrs:{label:t-1}},[e._v(e._s(t-1>=10?t-1:"0"+String(t-1)))])}))],1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addScheduler}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var f=o("VU/8")(p,_,!1,function(e){o("q3oi")},null,null);t.default=f.exports}});